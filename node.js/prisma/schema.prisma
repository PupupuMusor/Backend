generator client {
  provider = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String          @db.Uuid   @id @default(uuid())
  email           String?         @unique
  login           String          @unique
  fullName        String?         @map("full_name")
  officeId        String          @map("office_id") @db.Uuid 
  scores          Int

  userWeeklyStats  UserWeeklyStats[]
  UserSelections   UserSelections[]
  userAchievements UserAchievements[]
  
  office           Office   @relation(fields: [officeId], references: [id], onDelete: Cascade)

  @@map("user")
}

model Office {
  id              String          @db.Uuid   @id @default(uuid())

  user    User[]

  @@map("office")
}

model Questions {
  id          String   @db.Uuid @id @default(uuid())
  text        String
  scores       Int

  answers        Answers[]

  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  
  @@map("questions")
}

model Answers {
  id          String   @db.Uuid @id @default(uuid())
  questionId  String   @db.Uuid
  text        String?
  isRight     Boolean

  userSelection    UserSelections[]

  questions        Questions   @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@map("answers")
}

model UserSelections {
  id            String  @db.Uuid @id @default(uuid())
  userId        String  @db.Uuid
  answerId      String  @db.Uuid

  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  answers       Answers   @relation(fields: [answerId], references: [id], onDelete: Cascade)

  @@map("user_selections")
}

model Achievement {
  id           String            @db.Uuid  @id @default(uuid())
  name         String
  description  String
  pointsReward Int
  iconPath     String?

  user        UserAchievements[]

  @@map("achievement")
}

model UserAchievements {
  userId        String @db.Uuid
  achievementId String @db.Uuid

  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, achievementId])
  @@map("user_achievements")
}

model UserWeeklyStats {
  userId        String   @id @db.Uuid
  points        Int
  weekStartDate DateTime

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_weekly_stats")
}
